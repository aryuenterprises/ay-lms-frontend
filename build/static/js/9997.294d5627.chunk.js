"use strict";(self.webpackChunkable_pro_material_react=self.webpackChunkable_pro_material_react||[]).push([[9997],{99997:function(e,t,n){n.r(t);var r=n(93433),o=n(61819),i=n(1413),a=n(15861),s=n(29439),c=n(72791),l=n(697),d=n(13239),u=n(36314),m=n(20890),h=n(94294),p=n(94721),f=n(61889),x=n(57621),v=n(9585),Z=n(39504),g=n(85523),b=n(9955),w=n(72363),k=n(5574),j=n(65661),C=n(13400),S=n(39157),y=n(17133),_=n(48550),N=n(97123),B=n(36277),z=n(42161),M=n(89731),P=n(21830),F=n.n(P),I=n(23197),R=n(10163),E=(n(91587),n(80184)),A=["create","read","update","delete"];t.default=function(e){var t=e.onCancel,n=e.currentRole,P=(0,c.useState)(!1),T=(0,s.Z)(P,2),D=T[0],O=T[1],J=(0,c.useState)(null),W=(0,s.Z)(J,2),q=W[0],U=W[1],V=(0,c.useState)([]),X=(0,s.Z)(V,2),H=X[0],L=X[1],Y=(0,c.useState)(!0),$=(0,s.Z)(Y,2),G=$[0],K=$[1],Q=(0,c.useState)({permissions:[]}),ee=(0,s.Z)(Q,2),te=ee[0],ne=ee[1],re=function(){O(!1),U(null)},oe=(0,c.useCallback)(function(){var e=(0,a.Z)((0,o.Z)().mark((function e(t){var r,a,s,c,l,d;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,K(!0),e.next=4,M.Z.get("".concat(I.t6,"api/roles/").concat(n.role_id));case 4:(r=e.sent).data.success&&(a=r.data.data.module_permissions||[],s=r.data.modules||[],c=s.map((function(e){var t=a.find((function(t){return t.module_id===e.module_id}));return{id:e.module_id||null,module_id:e.module_id,module:e.module,permissions:(null===t||void 0===t?void 0:t.allowed_actions)||[]}})),L(c),ne({permissions:c}),t&&(l=JSON.parse(localStorage.getItem("auth")))&&l.user&&(d=(0,i.Z)((0,i.Z)({},l),{},{user:(0,i.Z)((0,i.Z)({},l.user),{},{permissions:c.map((function(e){return{module_id:e.module_id,module_name:e.module,allowed_actions:e.permissions}}))})}),localStorage.setItem("auth",JSON.stringify(d)))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch module data:",e.t0),F().fire({icon:"error",title:"Error",text:"Failed to fetch module data. Please try again.",showConfirmButton:!0});case 12:return e.prev=12,K(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,8,12,15]])})));return function(t){return e.apply(this,arguments)}}(),[n.role_id]);(0,c.useEffect)((function(){oe()}),[oe]);var ie=function(){var e=(0,a.Z)((0,o.Z)().mark((function e(t,r){var i,a,s,c,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.setSubmitting,e.prev=1,a=t.permissions.filter((function(e){return e.permissions})).map((function(e){return{module_id:e.id,allowed_actions:e.permissions}})),e.next=5,M.Z.patch("".concat(I.t6,"api/roles&permissions"),{role_id:n.role_id,module_permissions:a});case 5:if(!(s=e.sent).data.success){e.next=13;break}return!0,e.next=10,oe(true);case 10:F().fire({icon:"success",title:"Success",text:"Permissions updated successfully",showConfirmButton:!0}),e.next=15;break;case 13:throw F().fire({icon:"error",title:"Error",text:s.data.message||"Failed to save permissions",showConfirmButton:!0}),new Error(s.data.message||"Failed to save permissions");case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),console.error("Error saving permissions:",e.t0),F().fire({icon:"error",title:"Error",text:(null===(c=e.t0.response)||void 0===c||null===(l=c.data)||void 0===l?void 0:l.message)||"Failed to save permissions",showConfirmButton:!0});case 21:return e.prev=21,i(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[1,17,21,24]])})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=(0,a.Z)((0,o.Z)().mark((function e(t,n){var r,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.setSubmitting,i=n.resetForm,e.prev=1,!q){e.next=9;break}return e.next=5,M.Z.patch("".concat(I.t6,"api/modules&permissions/").concat(q.module_id),{module:t.moduleName.trim(),actions:[].concat(A)});case 5:e.sent.data.success&&F().fire({icon:"success",title:"Module Updated",text:"The module has been updated successfully.",showConfirmButton:!0}),e.next=13;break;case 9:return e.next=11,M.Z.post("".concat(I.t6,"api/modules&permissions"),{module:t.moduleName.trim(),actions:[].concat(A)});case 11:e.sent.data.success&&F().fire({icon:"success",title:"Module Added",text:"The new module has been added successfully.",showConfirmButton:!0});case 13:return e.next=15,oe();case 15:re(),i(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.error("Failed to save module:",e.t0),F().fire({icon:"error",title:"Error",text:"Failed to save module. Please try again.",showConfirmButton:!0});case 23:return e.prev=23,r(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,19,23,26]])})));return function(t,n){return e.apply(this,arguments)}}(),se=function(){var e=(0,a.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F().fire({title:"Are you sure?",text:'Do you want to delete the module "'.concat(t.module,'"?'),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"});case 2:if(!e.sent.isConfirmed){e.next=18;break}return e.prev=4,e.next=7,M.Z.patch("".concat(I.t6,"api/modules&permissions/").concat(t.id,"/archive"));case 7:if(!e.sent.data.success){e.next=12;break}return F().fire({icon:"success",title:"Deleted!",text:"The module has been deleted.",showConfirmButton:!0}),e.next=12,oe();case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("Failed to delete module:",e.t0),F().fire({icon:"error",title:"Error",text:"Failed to delete module. Please try again.",showConfirmButton:!0});case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}();return G?(0,E.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,E.jsx)(d.Z,{})}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{mb:3},children:[(0,E.jsxs)(m.Z,{variant:"h5",fontWeight:700,gutterBottom:!0,children:["Set Permissions for ",null===n||void 0===n?void 0:n.name]}),(0,E.jsx)(h.Z,{variant:"contained",onClick:function(){U(null),O(!0)},disabled:!0,className:"hidden",children:"Add New Module"})]}),(0,E.jsx)(p.Z,{sx:{mb:3}}),(0,E.jsx)(u.Z,{direction:"row",spacing:2,sx:{mb:3},children:(0,E.jsx)(h.Z,{onClick:t,variant:"outlined",color:"secondary",startIcon:(0,E.jsx)(z.Z,{}),children:"Back"})}),(0,E.jsx)(B.J9,{initialValues:te,onSubmit:ie,enableReinitialize:!0,children:function(e){var n=e.values,o=e.setFieldValue,i=e.isSubmitting,a=e.handleSubmit;return(0,E.jsxs)(B.l0,{onSubmit:a,children:[(0,E.jsx)(f.ZP,{container:!0,spacing:2,children:H.map((function(e){var t=n.permissions.find((function(t){return t.id===e.id})),i=t?t.permissions:[];return(0,E.jsx)(f.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,E.jsxs)(x.Z,{sx:{mb:3,boxShadow:2,height:"100%"},children:[(0,E.jsx)(v.Z,{title:e.module,action:(0,E.jsxs)(u.Z,{direction:"row",gap:1,children:[(0,E.jsx)(h.Z,{size:"small",onClick:function(){return function(e,t,n){var o=(0,r.Z)(n.permissions),i=o.findIndex((function(t){return t.id===e.id}));-1===i?o.push({id:e.id,module_id:e.module_id,module:e.module,permissions:[].concat(A)}):o[i].permissions=[].concat(A),t("permissions",o)}(e,o,n)},children:"Select All"}),(0,E.jsx)(h.Z,{size:"small",color:"error",onClick:function(){return function(e,t,n){var o=(0,r.Z)(n.permissions),i=o.findIndex((function(t){return t.id===e.id}));-1!==i&&(o[i].permissions=[],t("permissions",o))}(e,o,n)},children:"Clear All"})]})}),(0,E.jsx)(p.Z,{}),(0,E.jsx)(Z.Z,{children:(0,E.jsx)(f.ZP,{container:!0,spacing:2,children:A.map((function(t){var a=i.includes(t);return(0,E.jsx)(f.ZP,{item:!0,xs:6,children:(0,E.jsx)(g.Z,{control:(0,E.jsx)(b.Z,{checked:a,onChange:function(i){return function(e,t,n,o,i){var a=(0,r.Z)(i.permissions),s=a.findIndex((function(t){return t.id===e.id}));-1===s?a.push({id:e.id,module_id:e.module_id,module:e.module,permissions:n?[t]:[]}):n?a[s].permissions.includes(t)||a[s].permissions.push(t):a[s].permissions=a[s].permissions.filter((function(e){return e!==t})),o("permissions",a)}(e,t,i.target.checked,o,n)},color:"success"}),label:t.charAt(0).toUpperCase()+t.slice(1)})},t)}))})}),(0,E.jsx)(w.Z,{className:"hidden",children:(0,E.jsxs)(l.Z,{sx:{flex:1,display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(h.Z,{size:"small",color:"primary",onClick:function(){return function(e){U(e),O(!0)}(e)},disabled:!0,children:"Edit"}),(0,E.jsx)(h.Z,{size:"small",color:"error",onClick:function(){return se(e)},disabled:!0,children:"Delete"})]})})]})},e.id)}))}),(0,E.jsx)(p.Z,{sx:{my:3}}),(0,E.jsxs)(u.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,E.jsx)(h.Z,{variant:"outlined",onClick:t,children:"Cancel"}),(0,E.jsx)(h.Z,{type:"submit",variant:"contained",color:"primary",disabled:i,children:i?"Saving...":"Save Permissions"})]})]})}}),(0,E.jsxs)(k.Z,{open:D,onClose:re,maxWidth:"xs",fullWidth:!0,children:[(0,E.jsxs)(j.Z,{className:"dialogTitle",children:[q?"Edit Module":"Add Module",(0,E.jsx)(C.Z,{color:"dark",onClick:re,edge:"end",size:"big","aria-label":"close",title:"close",children:(0,E.jsx)(R.Z,{height:30})})]}),(0,E.jsx)(p.Z,{}),(0,E.jsx)(B.J9,{initialValues:q?{moduleName:q.module,permissions:q.permissions||[]}:{moduleName:"",permissions:[]},validate:function(e){var t={};return e.moduleName||(t.moduleName="Module name is required"),t},onSubmit:ae,enableReinitialize:!0,children:function(e){var t=e.errors,n=e.touched,r=e.handleChange,o=e.handleBlur,i=e.values,a=e.isSubmitting,s=e.handleSubmit;return(0,E.jsxs)(B.l0,{onSubmit:s,children:[(0,E.jsx)(S.Z,{children:(0,E.jsx)(l.Z,{children:(0,E.jsxs)(u.Z,{spacing:2,children:[(0,E.jsx)(y.Z,{children:"Module Name*"}),(0,E.jsx)(_.Z,{fullWidth:!0,id:"moduleName",name:"moduleName",placeholder:"Module Name",value:i.moduleName,onChange:r,onBlur:o,error:n.moduleName&&Boolean(t.moduleName),helperText:n.moduleName&&t.moduleName,disabled:a})]})})}),(0,E.jsxs)(N.Z,{sx:{p:3,pt:0},children:[(0,E.jsx)(h.Z,{onClick:re,disabled:a,children:"Cancel"}),(0,E.jsx)(h.Z,{type:"submit",variant:"contained",disabled:a||!i.moduleName.trim(),children:a?"Saving...":q?"Update":"Add Module"})]})]})}})]})]})}},9955:function(e,t,n){n.d(t,{Z:function(){return C}});var r=n(4942),o=n(63366),i=n(87462),a=n(72791),s=n(59278),c=n(94419),l=n(44402),d=n(14036),u=n(97278),m=n(31402),h=n(66934),p=n(75878),f=n(21217);function x(e){return(0,f.ZP)("MuiSwitch",e)}var v=(0,p.Z)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Z=n(80184),g=["className","color","edge","size","sx"],b=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.edge&&t["edge".concat((0,d.Z)(n.edge))],t["size".concat((0,d.Z)(n.size))]]}})((function(e){var t,n=e.ownerState;return(0,i.Z)({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},"start"===n.edge&&{marginLeft:-8},"end"===n.edge&&{marginRight:-8},"small"===n.size&&(t={width:40,height:24,padding:7},(0,r.Z)(t,"& .".concat(v.thumb),{width:16,height:16}),(0,r.Z)(t,"& .".concat(v.switchBase),(0,r.Z)({padding:4},"&.".concat(v.checked),{transform:"translateX(16px)"})),t))})),w=(0,h.ZP)(u.Z,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:function(e,t){var n=e.ownerState;return[t.switchBase,(0,r.Z)({},"& .".concat(v.input),t.input),"default"!==n.color&&t["color".concat((0,d.Z)(n.color))]]}})((function(e){var t,n=e.theme;return t={position:"absolute",top:0,left:0,zIndex:1,color:n.vars?n.vars.palette.Switch.defaultColor:"".concat("light"===n.palette.mode?n.palette.common.white:n.palette.grey[300]),transition:n.transitions.create(["left","transform"],{duration:n.transitions.duration.shortest})},(0,r.Z)(t,"&.".concat(v.checked),{transform:"translateX(20px)"}),(0,r.Z)(t,"&.".concat(v.disabled),{color:n.vars?n.vars.palette.Switch.defaultDisabledColor:"".concat("light"===n.palette.mode?n.palette.grey[100]:n.palette.grey[600])}),(0,r.Z)(t,"&.".concat(v.checked," + .").concat(v.track),{opacity:.5}),(0,r.Z)(t,"&.".concat(v.disabled," + .").concat(v.track),{opacity:n.vars?n.vars.opacity.switchTrackDisabled:"".concat("light"===n.palette.mode?.12:.2)}),(0,r.Z)(t,"& .".concat(v.input),{left:"-100%",width:"300%"}),t}),(function(e){var t,n=e.theme,o=e.ownerState;return(0,i.Z)({"&:hover":{backgroundColor:n.vars?"rgba(".concat(n.vars.palette.action.activeChannel," / ").concat(n.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(n.palette.action.active,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==o.color&&(t={},(0,r.Z)(t,"&.".concat(v.checked),(0,r.Z)({color:(n.vars||n).palette[o.color].main,"&:hover":{backgroundColor:n.vars?"rgba(".concat(n.vars.palette[o.color].mainChannel," / ").concat(n.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(n.palette[o.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&.".concat(v.disabled),{color:n.vars?n.vars.palette.Switch["".concat(o.color,"DisabledColor")]:"".concat("light"===n.palette.mode?(0,l.$n)(n.palette[o.color].main,.62):(0,l._j)(n.palette[o.color].main,.55))})),(0,r.Z)(t,"&.".concat(v.checked," + .").concat(v.track),{backgroundColor:(n.vars||n).palette[o.color].main}),t))})),k=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:function(e,t){return t.track}})((function(e){var t=e.theme;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:"".concat("light"===t.palette.mode?t.palette.common.black:t.palette.common.white),opacity:t.vars?t.vars.opacity.switchTrack:"".concat("light"===t.palette.mode?.38:.3)}})),j=(0,h.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:function(e,t){return t.thumb}})((function(e){var t=e.theme;return{boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}})),C=a.forwardRef((function(e,t){var n=(0,m.Z)({props:e,name:"MuiSwitch"}),r=n.className,a=n.color,l=void 0===a?"primary":a,u=n.edge,h=void 0!==u&&u,p=n.size,f=void 0===p?"medium":p,v=n.sx,C=(0,o.Z)(n,g),S=(0,i.Z)({},n,{color:l,edge:h,size:f}),y=function(e){var t=e.classes,n=e.edge,r=e.size,o=e.color,a=e.checked,s=e.disabled,l={root:["root",n&&"edge".concat((0,d.Z)(n)),"size".concat((0,d.Z)(r))],switchBase:["switchBase","color".concat((0,d.Z)(o)),a&&"checked",s&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=(0,c.Z)(l,x,t);return(0,i.Z)({},t,u)}(S),_=(0,Z.jsx)(j,{className:y.thumb,ownerState:S});return(0,Z.jsxs)(b,{className:(0,s.Z)(y.root,r),sx:v,ownerState:S,children:[(0,Z.jsx)(w,(0,i.Z)({type:"checkbox",icon:_,checkedIcon:_,ref:t,ownerState:S},C,{classes:(0,i.Z)({},y,{root:y.switchBase})})),(0,Z.jsx)(k,{className:y.track,ownerState:S})]})}))}}]);
//# sourceMappingURL=9997.294d5627.chunk.js.map