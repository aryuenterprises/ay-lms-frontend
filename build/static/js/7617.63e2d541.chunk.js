"use strict";(self.webpackChunkable_pro_material_react=self.webpackChunkable_pro_material_react||[]).push([[7617],{42664:function(e,t,r){r.d(t,{g:function(){return s}});var n=r(72791),s=function(){return{checkPermission:(0,n.useCallback)((function(e,t){try{var r,n=JSON.parse(localStorage.getItem("auth")||"[]"),s=null===n||void 0===n?void 0:n.loginType,i=(null===n||void 0===n||null===(r=n.user)||void 0===r?void 0:r.permissions)||[];return"super_admin"===s||"admin"===s&&i.some((function(r){return r.module_name===e&&r.allowed_actions.includes(t)}))}catch(o){return console.error("Error checking permission:",o),!1}}),[])}}},97617:function(e,t,r){r.r(t);var n=r(93433),s=r(1413),i=r(61819),o=r(15861),a=r(29439),l=r(72791),c=r(697),d=r(61889),u=r(36314),p=r(13400),x=r(20890),m=r(94294),h=r(35527),f=r(81918),v=r(20068),Z=r(17133),g=r(68096),b=r(58406),y=r(23786),j=r(47071),w=r(48550),q=r(61419),k=r(42419),C=r(27247),_=r(67394),S=r(24034),B=r(57689),I=r(89731),A=r(23197),z=r(21830),F=r.n(z),Q=r(29913),T=r(95683),W=r(64370),E=r(62634),O=r(36277),R=r(8007),P=r(42664),V=r(80184),M=function(e){var t=e.formik,r=e.onTypeChange,n=e.addOption,s=e.removeOption,i=e.onOptionChange;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)(d.ZP,{container:!0,spacing:2,sx:{mt:2},children:[(0,V.jsx)(d.ZP,{item:!0,xs:12,md:6,children:(0,V.jsxs)(u.Z,{spacing:1.5,children:[(0,V.jsx)(Z.Z,{children:"Question Type"}),(0,V.jsxs)(g.Z,{fullWidth:!0,error:t.touched.type&&Boolean(t.errors.type),children:[(0,V.jsxs)(b.Z,{name:"type",value:t.values.type,onChange:function(e){t.handleChange(e),r(e.target.value)},onBlur:t.handleBlur,children:[(0,V.jsx)(y.Z,{value:"written",children:"Written Answer"}),(0,V.jsx)(y.Z,{value:"mcq",children:"Multiple Choice"})]}),t.touched.type&&t.errors.type&&(0,V.jsx)(j.Z,{error:!0,children:t.errors.type})]})]})}),(0,V.jsx)(d.ZP,{item:!0,xs:12,md:6,children:(0,V.jsxs)(u.Z,{spacing:1.5,children:[(0,V.jsx)(Z.Z,{children:"Marks"}),(0,V.jsx)(w.Z,{fullWidth:!0,name:"marks",type:"number",value:t.values.marks,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.marks&&Boolean(t.errors.marks),helperText:t.touched.marks&&t.errors.marks,inputProps:{min:1}})]})})]}),(0,V.jsx)(w.Z,{fullWidth:!0,name:"question",label:"Question Text",value:t.values.question,onChange:t.handleChange,onBlur:t.handleBlur,error:t.touched.question&&Boolean(t.errors.question),helperText:t.touched.question&&t.errors.question,multiline:!0,rows:2,sx:{mt:2,mb:2}}),"mcq"===t.values.type&&(0,V.jsxs)(c.Z,{sx:{mt:2},children:[(0,V.jsx)(x.Z,{variant:"subtitle1",gutterBottom:!0,children:"Options (Provide at least 2 options)"}),t.values.options.map((function(e,r){return(0,V.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,V.jsx)(q.Z,{disabled:!0}),(0,V.jsx)(w.Z,{sx:{width:300},value:e,onChange:function(e){return i(r,e.target.value)},onBlur:t.handleBlur,error:t.touched.options&&t.errors.options&&t.errors.options[r],label:"Option ".concat(r+1),size:"small"}),(0,V.jsx)(p.Z,{onClick:function(){return s(r)},disabled:t.values.options.length<=2,sx:{ml:1,color:"error.main"},children:(0,V.jsx)(C.Z,{})})]},r)})),t.touched.options&&t.errors.options&&"string"===typeof t.errors.options&&(0,V.jsx)(j.Z,{error:!0,sx:{mt:1},children:t.errors.options}),(0,V.jsx)(m.Z,{onClick:n,startIcon:(0,V.jsx)(k.Z,{}),sx:{mt:1},children:"Add Option"})]}),("written"===t.values.type||"mcq"===t.values.type)&&(0,V.jsx)(w.Z,{fullWidth:!0,name:"expected_answer",label:"Correct Answer (For reference)",value:t.values.expected_answer,onChange:t.handleChange,onBlur:t.handleBlur,multiline:!0,rows:3,sx:{mt:2}})]})};t.default=function(){var e,t=(0,B.TH)(),r=(0,B.s0)(),Z=null===(e=t.state)||void 0===e?void 0:e.module,g=null===Z||void 0===Z?void 0:Z.test_id,b=(0,P.g)().checkPermission,y=b("Assessment","create"),j=b("Assessment","update"),w=b("Assessment","delete"),q=(0,l.useState)([]),k=(0,a.Z)(q,2),z=k[0],H=k[1],N=(0,l.useState)(!0),D=(0,a.Z)(N,2),Y=D[0],L=D[1],X=(0,l.useState)(null),G=(0,a.Z)(X,2),J=G[0],U=G[1],K=(0,l.useState)("view"),$=(0,a.Z)(K,2),ee=$[0],te=$[1],re=(0,l.useState)(null),ne=(0,a.Z)(re,2),se=ne[0],ie=ne[1],oe=R.Ry().shape({question:R.Z_().required("Question text is required"),type:R.Z_().oneOf(["written","mcq"],"Invalid question type").required("Question type is required"),marks:R.Rx().min(1,"Marks must be at least 1").required("Marks are required"),options:R.IX().when("type",{is:function(e){return"mcq"===e},then:function(){return R.IX().of(R.Z_().required("Option text is required")).min(2,"At least 2 options are required").test("unique-options","Options must be unique",(function(e){if(!e||e.length<2)return!0;var t=e.filter((function(e){return e&&""!==e.trim()}));return new Set(t.map((function(e){return e.trim().toLowerCase()}))).size===t.length}))},otherwise:function(){return R.IX().notRequired()}}),expected_answer:R.Z_().when("type",{is:function(e){return"written"===e},then:function(){return R.Z_().required("Expected answer is required for written questions")},otherwise:function(){return R.Z_()}})}),ae=(0,O.TA)({initialValues:{question:"",type:"written",marks:1,options:[],expected_answer:""},validationSchema:oe,onSubmit:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("add"!==ee){e.next=5;break}return e.next=3,ce(t);case 3:e.next=8;break;case 5:if("edit"!==ee){e.next=8;break}return e.next=8,de(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),le=(0,l.useCallback)((0,o.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.Z.get("".concat(A.t6,"api/test/").concat(g,"/questions"));case 3:(t=e.sent).data.success?H(t.data.questions||[]):U(t.data.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),U(e.t0.message),console.error("Error fetching questions:",e.t0);case 11:return e.prev=11,L(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,7,11,14]])}))),[g]);(0,l.useEffect)((function(){g?le():(H([]),L(!1))}),[g,le]);var ce=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var r,o,a,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"mcq"!==t.type){e.next=11;break}if(!t.options.some((function(e){return!e||""===e.trim()}))){e.next=6;break}return F().fire("Error","All options must have text","error"),e.abrupt("return");case 6:if(r=t.options.filter((function(e){return e&&""!==e.trim()})),new Set(r.map((function(e){return e.trim().toLowerCase()}))).size===r.length){e.next=11;break}return F().fire("Error","Options must be unique. Please remove duplicate options.","error"),e.abrupt("return");case 11:return e.next=13,I.Z.post("".concat(A.t6,"api/test/questions"),[(0,s.Z)((0,s.Z)({test_id:g,question:t.question,type:t.type,options:"mcq"===t.type?t.options:[],marks:parseInt(t.marks)||1},"written"===t.type&&{written_answer:t.expected_answer}),"mcq"===t.type&&{mcq_correct_option:t.expected_answer})]);case 13:(o=e.sent).data.success?(F().fire("Success","Question added successfully","success"),H((function(e){return[].concat((0,n.Z)(e),[o.data.data[0]])})),ae.resetForm(),te("view")):F().fire("Error",o.data.message,"error"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),F().fire("Error",(null===(a=e.t0.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||"Failed to add question","error");case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var r,n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.Z.put("".concat(A.t6,"api/test/questions/").concat(se.question_id||se.id),(0,s.Z)((0,s.Z)({test_id:g,question:t.question,type:t.type,options:"mcq"===t.type?t.options:[],marks:parseInt(t.marks)||1},"written"===t.type&&{written_answer:t.expected_answer}),"mcq"===t.type&&{mcq_correct_option:t.expected_answer}));case 3:if(!(r=e.sent).data.success){e.next=13;break}return F().fire("Success","Question updated successfully","success"),e.next=8,le();case 8:ae.resetForm(),te("view"),ie(null),e.next=14;break;case 13:F().fire("Error",r.data.message,"error");case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),F().fire("Error",(null===(n=e.t0.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"Failed to update question","error");case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var r,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F().fire({title:"Are you sure?",text:"This will delete the question permanently.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"});case 2:if(!e.sent.isConfirmed){e.next=14;break}return e.prev=4,e.next=7,I.Z.patch("".concat(A.t6,"api/test/questions/").concat(t,"/archive"));case 7:(r=e.sent).data.success?(F().fire("Deleted!","Question has been deleted.","success"),H((function(e){return e.filter((function(e){return e.question_id!==t}))}))):F().fire("Error",r.data.message,"error"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),F().fire("Error",(null===(n=e.t0.response)||void 0===n||null===(s=n.data)||void 0===s?void 0:s.message)||"Failed to delete question","error");case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}();return Y?(0,V.jsx)("div",{children:"Loading questions..."}):J?(0,V.jsx)(S.Z,{sx:{borderRadius:2},children:(0,V.jsxs)(c.Z,{p:3,color:"error.main",children:["Error: ",J]})}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(d.ZP,{container:!0,spacing:3,sx:{position:"absolute",top:18,left:"50%",zIndex:1,width:"50%"},children:(0,V.jsx)(d.ZP,{item:!0,xs:12,sx:{justifyItems:"flex-end"},children:(0,V.jsx)(u.Z,{sx:{mb:{xs:-.5,sm:.5}},spacing:1,children:(0,V.jsxs)(p.Z,{variant:"contained",color:"secondary",size:"medium",onClick:function(){r(-1)},sx:{width:100,gap:1},children:[(0,V.jsx)(_.Z,{}),"Back"]})})})}),(0,V.jsxs)(S.Z,{sx:{p:3,display:"flex",flexDirection:"column",minHeight:"80vh"},children:[(0,V.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"2px solid",borderColor:"divider"},children:[(0,V.jsx)(x.Z,{variant:"h4",sx:{fontWeight:700},children:g?"Manage Assessment Questions":"Create New Assessment"}),"view"===ee&&(0,V.jsx)(c.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:2,pb:2},children:y&&(0,V.jsx)(m.Z,{variant:"contained",startIcon:(0,V.jsx)(W.Z,{}),onClick:function(){var e={id:Date.now(),question:"",type:"written",options:[],marks:1,expected_answer:""};ie(e),ae.setValues(e),te("add")},sx:{borderRadius:2,px:3},children:"Add New Question"})})]}),"view"===ee&&(0,V.jsx)(c.Z,{sx:{flexGrow:1,overflowY:"auto",mb:4},children:0===z.length?(0,V.jsxs)(h.Z,{elevation:2,sx:{p:4,textAlign:"center",borderRadius:2},children:[(0,V.jsx)(x.Z,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Questions Added Yet"}),(0,V.jsx)(x.Z,{variant:"body2",color:"text.secondary",children:"Start by adding your first question using the form below."})]}):(0,V.jsx)(d.ZP,{container:!0,spacing:3,p:2,children:z.map((function(e,t){return(0,V.jsx)(d.ZP,{item:!0,xs:12,md:6,children:(0,V.jsxs)(h.Z,{elevation:1,sx:{p:2.5,borderRadius:2,position:"relative",border:"1px solid",borderColor:"divider",transition:"all 0.2s ease",background:"linear-gradient(to bottom, #ffffff, #fafafa)","&:hover":{boxShadow:"0 4px 12px rgba(0,0,0,0.1)",borderColor:"secondary.light",transform:"translateY(-2px)"}},children:[(0,V.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,borderBottom:"1px solid",borderColor:"divider",pb:1.5},children:[(0,V.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,V.jsx)(f.Z,{label:"Q".concat(t+1),color:"primary",size:"small",sx:{fontWeight:600,borderRadius:1,mr:1.5}}),(0,V.jsx)(f.Z,{label:"".concat(e.marks||5," marks"),size:"small",variant:"outlined",sx:{fontWeight:500,color:"success.dark",borderColor:"success.light",backgroundColor:"success.10",borderRadius:1}})]}),(0,V.jsxs)(c.Z,{children:[j&&(0,V.jsx)(v.Z,{title:"Edit Question",children:(0,V.jsx)(p.Z,{"aria-label":"edit",onClick:function(){return function(e){var t=(0,s.Z)((0,s.Z)({},e),{},{options:e.options||[],expected_answer:e.mcq_correct_option||e.written_answer||""});ie(t),ae.setValues(t),te("edit")}(e)},sx:{color:"text.secondary",mr:.5,"&:hover":{backgroundColor:"primary.light",color:"white"}},size:"small",children:(0,V.jsx)(E.Z,{fontSize:"small"})})}),w&&(0,V.jsx)(v.Z,{title:"Delete Question",children:(0,V.jsx)(p.Z,{"aria-label":"delete",onClick:function(){return ue(e.question_id||e.id)},sx:{color:"text.secondary","&:hover":{backgroundColor:"error.light",color:"white"}},size:"small",children:(0,V.jsx)(C.Z,{fontSize:"small",color:"error"})})})]})]}),(0,V.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:500,mb:2,lineHeight:1.5,color:"text.primary"},children:e.question}),"mcq"===e.type&&e.options&&e.options.length>0&&(0,V.jsxs)(c.Z,{sx:{mt:2.5,mb:1.5},children:[(0,V.jsx)(x.Z,{variant:"caption",sx:{fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5,fontSize:"0.75rem"},children:"Options:"}),(0,V.jsx)(c.Z,{sx:{mt:1},children:e.options.map((function(t,r){return(0,V.jsxs)(c.Z,{sx:{display:"flex",alignItems:"center",py:.75,borderBottom:r<e.options.length-1?"1px dashed":"none",borderColor:"divider"},children:[(0,V.jsx)(c.Z,{sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",mr:1.5,color:"white",fontSize:"0.7rem",fontWeight:600},children:String.fromCharCode(65+r)}),(0,V.jsx)(x.Z,{variant:"body2",sx:{color:"text.primary"},children:t})]},r)}))})]}),"written"===e.type&&e.written_answer&&(0,V.jsxs)(c.Z,{sx:{mt:2.5,mb:1.5},children:[(0,V.jsx)(x.Z,{variant:"caption",sx:{fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5,fontSize:"0.75rem"},children:"Correct Answer:"}),(0,V.jsx)(c.Z,{sx:{mt:1,p:1.5,backgroundColor:"grey.50",borderRadius:1,border:"1px solid",borderColor:"divider",position:"relative"},children:(0,V.jsx)(x.Z,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary",lineHeight:1.6},children:e.written_answer})})]}),"mcq"===e.type&&e.mcq_correct_option&&(0,V.jsxs)(c.Z,{sx:{mt:2.5,mb:1.5},children:[(0,V.jsx)(x.Z,{variant:"caption",sx:{fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5,fontSize:"0.75rem"},children:"Correct Answer:"}),(0,V.jsx)(c.Z,{sx:{mt:1,p:1.5,backgroundColor:"grey.50",borderRadius:1,border:"1px solid",borderColor:"divider",position:"relative"},children:(0,V.jsx)(x.Z,{variant:"body2",sx:{fontStyle:"italic",color:"text.secondary",lineHeight:1.6},children:e.mcq_correct_option})})]}),(0,V.jsx)(c.Z,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",mt:2.5,pt:1.5,borderTop:"1px solid",borderColor:"secondary.light"},children:(0,V.jsx)(f.Z,{label:"mcq"===e.type?"Multiple Choice":"Written Answer",size:"small",variant:"outlined",sx:{fontWeight:500,fontSize:"0.75rem",backgroundColor:"secondary.light",color:"secondary.dark",borderColor:"secondary.light"}})})]})},e.question_id)}))})}),("add"===ee||"edit"===ee&&se)&&(0,V.jsxs)(h.Z,{elevation:4,sx:{p:3.5,mb:4,mt:2,borderRadius:2},children:[(0,V.jsx)(x.Z,{variant:"h5",gutterBottom:!0,sx:{color:"primary.main",fontWeight:600,display:"flex",alignItems:"center",gap:1},children:"add"===ee?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Q.Z,{})," Add New Question"]}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(E.Z,{})," Edit Question"]})}),(0,V.jsxs)("form",{onSubmit:ae.handleSubmit,children:[(0,V.jsx)(M,{formik:ae,onTypeChange:function(e){ae.setFieldValue("type",e),"written"===e?ae.setFieldValue("options",[]):"mcq"===e&&0===ae.values.options.length&&ae.setFieldValue("options",["",""])},addOption:function(){var e=[].concat((0,n.Z)(ae.values.options),[""]);ae.setFieldValue("options",e)},removeOption:function(e){if(!(ae.values.options.length<=2)){var t=(0,n.Z)(ae.values.options);t.splice(e,1),ae.setFieldValue("options",t)}},onOptionChange:function(e,t){var r=(0,n.Z)(ae.values.options);r[e]=t,ae.setFieldValue("options",r)}}),(0,V.jsxs)(c.Z,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,V.jsx)(m.Z,{variant:"outlined",color:"secondary",onClick:function(){ae.resetForm(),ie(null),te("view")},sx:{borderRadius:2,px:3},disabled:ae.isSubmitting,children:"Cancel"}),(0,V.jsx)(m.Z,{type:"submit",variant:"contained",startIcon:(0,V.jsx)(T.Z,{}),sx:{borderRadius:2,px:3},disabled:ae.isSubmitting,children:"add"===ee?"Save Question":"Update Question"})]})]})]})]})]})}}}]);
//# sourceMappingURL=7617.63e2d541.chunk.js.map