"use strict";(self.webpackChunkable_pro_material_react=self.webpackChunkable_pro_material_react||[]).push([[7302],{42664:function(e,n,t){t.d(n,{g:function(){return i}});var r=t(72791),i=function(){return{checkPermission:(0,r.useCallback)((function(e,n){try{var t,r=JSON.parse(localStorage.getItem("auth")||"[]"),i=null===r||void 0===r?void 0:r.loginType,a=(null===r||void 0===r||null===(t=r.user)||void 0===t?void 0:t.permissions)||[];return"super_admin"===i||"admin"===i&&a.some((function(t){return t.module_name===e&&t.allowed_actions.includes(n)}))}catch(o){return console.error("Error checking permission:",o),!1}}),[])}}},7302:function(e,n,t){t.r(n);var r=t(61819),i=t(1413),a=t(15861),o=t(29439),c=t(72791),l=t(43513),s=t(93044),u=t(697),d=t(20068),p=t(13400),h=t(61889),m=t(36314),x=t(94294),g=t(5574),f=t(65661),Z=t(39157),b=t(17133),v=t(48550),j=t(58406),k=t(23786),_=t(97123),C=t(62634),S=t(17139),w=t(60592),y=t(10163),B=t(36277),T=t(89731),A=t(8007),P=t(2314),E=t(66770),F=t.n(E),O=(t(86009),t(9826),t(11152)),N=(t(91587),t(69977),t(24034)),z=t(23197),I=t(21830),R=t.n(I),W=t(85680),q=t(42664),D=t(80184);E.Quill.register("modules/emoji",O);n.default=function(){var e=(0,q.g)().checkPermission,n=e("Announcements","create"),t=e("Announcements","update"),E=e("Announcements","delete"),O=(0,c.useState)(!1),I=(0,o.Z)(O,2),K=I[0],U=I[1],V=(0,c.useState)(null),M=(0,o.Z)(V,2),Y=M[0],H=M[1],J=(0,c.useState)([]),L=(0,o.Z)(J,2),Q=L[0],G=L[1],X=(0,c.useState)(!0),$=(0,o.Z)(X,2),ee=$[0],ne=$[1],te=(0,c.useState)(""),re=(0,o.Z)(te,2),ie=re[0],ae=re[1],oe=(0,c.useState)(null),ce=(0,o.Z)(oe,2),le=ce[0],se=ce[1],ue=(0,c.useCallback)((0,a.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T.Z.get("".concat(z.t6,"api/announcements"));case 3:n=e.sent,t=n.data.map((function(e,n){return(0,i.Z)((0,i.Z)({},e),{},{sno:n+1})})),G(t),ne(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error fetching announcements:",e.t0),ne(!1);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),[]);(0,c.useEffect)((function(){ue()}),[ue]);var de=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,R().fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"});case 3:if(!e.sent.isConfirmed){e.next=9;break}return e.next=7,T.Z.patch("".concat(z.t6,"api/announcements/").concat(n,"/archive"));case 7:G(Q.filter((function(e){return e.id!==n}))),R().fire({title:"Success!",text:"Announcement deleted successfully",icon:"success",confirmButtonText:"OK"});case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error deleting announcement:",e.t0),R().fire({title:"Error!",text:"Failed to delete announcement",icon:"error",confirmButtonText:"OK"});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(n){return e.apply(this,arguments)}}(),pe=function(){U(!1)},he=A.Ry().shape({title:A.Z_().required("Title is required")}),me=(0,B.TA)({initialValues:{title:(null===Y||void 0===Y?void 0:Y.title)||"",audience:(null===Y||void 0===Y?void 0:Y.audience)||"",background_pic:null,content:(null===Y||void 0===Y?void 0:Y.content)||""},validationSchema:he,enableReinitialize:!0,onSubmit:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,t){var i,a,o,c,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.setSubmitting,e.prev=1,(a=new FormData).append("title",n.title),a.append("audience",n.audience),a.append("content",ie),n.background_pic instanceof File?a.append("background_pic",n.background_pic):null!==Y&&void 0!==Y&&Y.background_pic&&a.append("background_pic_path",Y.background_pic),!Y){e.next=13;break}return e.next=10,T.Z.patch("".concat(z.t6,"api/announcements/").concat(Y.id),a,{headers:{"Content-Type":"multipart/form-data"}});case 10:o=e.sent,e.next=16;break;case 13:return e.next=15,T.Z.post("".concat(z.t6,"api/announcements"),a,{headers:{"Content-Type":"multipart/form-data"}});case 15:o=e.sent;case 16:!0===o.data.success&&(R().fire({title:"Success!",text:o.data.message,icon:"success",confirmButtonText:"OK"}),ue(),pe()),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.error("Error saving announcement:",e.t0),R().fire({title:"Error!",text:(null===(c=e.t0.response)||void 0===c||null===(l=c.data)||void 0===l?void 0:l.message)||"Failed to save announcement",icon:"error",confirmButtonText:"OK"});case 23:return e.prev=23,i(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,19,23,26]])})));return function(n,t){return e.apply(this,arguments)}}()}),xe=[{name:"S.No",selector:function(e){return e.sno},sortable:!0,width:"80px"},{name:"Title",selector:function(e){return(0,W.Z)(e.title)},sortable:!0},{name:"Type",selector:function(e){return(0,W.Z)(e.audience)},sortable:!0},{name:"Background Image",cell:function(e){return e.background_pic_url?(0,D.jsx)(s.Z,{src:"".concat(e.background_pic_url),variant:"rounded",sx:{width:80,height:60}}):"No image"}},{name:"Actions",cell:function(e){return(0,D.jsxs)(u.Z,{sx:{display:"flex",gap:1},children:[t&&(0,D.jsx)(d.Z,{title:"Edit",children:(0,D.jsx)(p.Z,{variant:"contained",color:"info",onClick:function(){return H(n=e),ae(n.content||""),se(n.background_pic_url?"".concat(n.background_pic_url):null),void U(!0);var n},children:(0,D.jsx)(C.Z,{})})}),E&&(0,D.jsx)(d.Z,{title:"Delete",children:(0,D.jsx)(p.Z,{variant:"contained",color:"error",onClick:function(){return de(e.id)},children:(0,D.jsx)(S.Z,{})})})]})}}];return(0,D.jsxs)(N.Z,{children:[(0,D.jsx)(h.ZP,{item:!0,container:!0,justifyContent:"flex-end",mb:3,children:(0,D.jsx)(h.ZP,{item:!0,children:(0,D.jsx)(m.Z,{spacing:2,children:(0,D.jsx)(u.Z,{sx:{display:"flex"},children:n&&(0,D.jsx)(x.Z,{color:"success",variant:"contained",startIcon:(0,D.jsx)(w.Z,{}),onClick:function(){H(null),ae(""),se(null),U(!0)},children:"Add New Announcement"})})})})}),(0,D.jsx)(l.ZP,{columns:xe,data:Q,pagination:!0,progressPending:ee,paginationPerPage:10,paginationRowsPerPageOptions:[5,10,20,30],highlightOnHover:!0,responsive:!0}),(0,D.jsxs)(g.Z,{maxWidth:"md",TransitionComponent:P.S,keepMounted:!0,fullWidth:!0,open:K,onClose:function(e,n){"backdropClick"!==n&&pe()},BackdropProps:{onClick:function(e){return e.stopPropagation()}},sx:{"& .MuiDialog-paper":{p:0},transition:"transform 225ms"},"aria-describedby":"alert-dialog-slide-description",children:[(0,D.jsxs)(f.Z,{className:"dialogTitle",children:[Y?"Edit Announcement":"Add New Announcement",(0,D.jsx)(p.Z,{color:"dark",onClick:pe,edge:"end",size:"big","aria-label":"close",children:(0,D.jsx)(y.Z,{})})]}),(0,D.jsx)(Z.Z,{children:(0,D.jsxs)("form",{onSubmit:me.handleSubmit,children:[(0,D.jsxs)(h.ZP,{container:!0,spacing:2,sx:{mt:1},children:[(0,D.jsx)(h.ZP,{item:!0,xs:12,md:6,children:(0,D.jsxs)(m.Z,{spacing:1,children:[(0,D.jsx)(b.Z,{children:"Title *"}),(0,D.jsx)(v.Z,{fullWidth:!0,id:"title",name:"title",placeholder:"Enter announcement title",value:me.values.title,onChange:me.handleChange,onBlur:me.handleBlur,error:me.touched.title&&Boolean(me.errors.title),helperText:me.touched.title&&me.errors.title})]})}),(0,D.jsx)(h.ZP,{item:!0,xs:12,md:6,children:(0,D.jsxs)(m.Z,{spacing:1,children:[(0,D.jsx)(b.Z,{children:"Select user *"}),(0,D.jsxs)(j.Z,{fullWidth:!0,id:"audience",name:"audience",displayEmpty:!0,value:me.values.audience,onChange:me.handleChange,onBlur:me.handleBlur,error:me.touched.audience&&Boolean(me.errors.audience),children:[(0,D.jsx)(k.Z,{value:"",children:"Select user"}),(0,D.jsx)(k.Z,{value:"students",children:"Students"}),(0,D.jsx)(k.Z,{value:"trainers",children:"Trainers"}),(0,D.jsx)(k.Z,{value:"all",children:"All"})]})]})}),(0,D.jsx)(h.ZP,{item:!0,xs:12,md:6,children:(0,D.jsxs)(m.Z,{spacing:1,children:[(0,D.jsx)(b.Z,{children:"Background Image"}),(0,D.jsx)("input",{accept:"image/*",style:{display:"none"},id:"background-pic-upload",type:"file",onChange:function(e){var n=e.currentTarget.files[0];if(n){me.setFieldValue("background_pic",n);var t=new FileReader;t.onload=function(){se(t.result)},t.readAsDataURL(n)}}}),(0,D.jsx)("label",{htmlFor:"background-pic-upload",children:(0,D.jsx)(x.Z,{variant:"outlined",component:"span",fullWidth:!0,children:"Upload Background Image"})}),me.touched.background_pic&&me.errors.background_pic&&(0,D.jsx)(u.Z,{sx:{color:"error.main",fontSize:"0.75rem"},children:me.errors.background_pic}),le&&(0,D.jsx)(u.Z,{mt:2,children:(0,D.jsx)(s.Z,{src:le,variant:"rounded",sx:{width:"100%",height:150}})})]})}),(0,D.jsx)(h.ZP,{item:!0,xs:12,children:(0,D.jsxs)(m.Z,{spacing:1,children:[(0,D.jsx)(b.Z,{children:"Content"}),(0,D.jsx)(u.Z,{sx:{height:300,mb:3},children:(0,D.jsx)(F(),{theme:"snow",value:ie,onChange:ae,modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike","blockquote"],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{align:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video","emoji"],["code-block"],["clean"]],clipboard:{matchVisual:!1},"emoji-toolbar":!0,"emoji-textarea":!1,"emoji-shortname":!0},formats:["header","font","size","bold","italic","underline","strike","blockquote","color","background","script","align","list","bullet","indent","link","image","video","code-block","emoji"],style:{height:"250px"}})})]})})]}),(0,D.jsxs)(_.Z,{sx:{mt:3},children:[(0,D.jsx)(x.Z,{onClick:pe,children:"Cancel"}),(0,D.jsx)(x.Z,{type:"submit",variant:"contained",disabled:me.isSubmitting,children:Y?"Update Announcement":"Add Announcement"})]})]})})]})]})}},69977:function(){}}]);
//# sourceMappingURL=7302.53bd7fd8.chunk.js.map