"use strict";(self.webpackChunkable_pro_material_react=self.webpackChunkable_pro_material_react||[]).push([[9997],{99997:function(e,n,r){r.r(n);var t=r(93433),i=r(61819),s=r(1413),o=r(15861),a=r(29439),l=r(72791),c=r(697),d=r(13239),u=r(36314),m=r(20890),p=r(94294),f=r(94721),h=r(61889),x=r(57621),Z=r(9585),b=r(39504),v=r(85523),g=r(9955),j=r(72363),C=r(5574),k=r(65661),w=r(13400),y=r(39157),S=r(17133),P=r(48550),_=r(97123),N=r(36277),B=r(42161),F=r(89731),M=r(21830),E=r.n(M),R=r(23197),A=r(10163),T=(r(91587),r(80184)),q=["create","read","update","delete"];n.default=function(e){var n=e.onCancel,r=e.currentRole,M=(0,l.useState)(!1),I=(0,a.Z)(M,2),L=I[0],z=I[1],D=(0,l.useState)(null),W=(0,a.Z)(D,2),J=W[0],U=W[1],V=(0,l.useState)([]),H=(0,a.Z)(V,2),O=H[0],Y=H[1],G=(0,l.useState)(!0),K=(0,a.Z)(G,2),Q=K[0],X=K[1],$=(0,l.useState)({permissions:[]}),ee=(0,a.Z)($,2),ne=ee[0],re=ee[1],te=function(){z(!1),U(null)},ie=(0,l.useCallback)(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){var t,o,a,l,c,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,X(!0),e.next=4,F.Z.get("".concat(R.t6,"api/roles/").concat(r.role_id));case 4:(t=e.sent).data.success&&(o=t.data.data.module_permissions||[],a=t.data.modules||[],l=a.map((function(e){var n=o.find((function(n){return n.module_id===e.module_id}));return{id:e.module_id||null,module_id:e.module_id,module:e.module,permissions:(null===n||void 0===n?void 0:n.allowed_actions)||[]}})),Y(l),re({permissions:l}),n&&(c=JSON.parse(localStorage.getItem("auth")))&&c.user&&(d=(0,s.Z)((0,s.Z)({},c),{},{user:(0,s.Z)((0,s.Z)({},c.user),{},{permissions:l.map((function(e){return{module_id:e.module_id,module_name:e.module,allowed_actions:e.permissions}}))})}),localStorage.setItem("auth",JSON.stringify(d)))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to fetch module data:",e.t0),E().fire({icon:"error",title:"Error",text:"Failed to fetch module data. Please try again.",showConfirmButton:!0});case 12:return e.prev=12,X(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,8,12,15]])})));return function(n){return e.apply(this,arguments)}}(),[r.role_id]);(0,l.useEffect)((function(){ie()}),[ie]);var se=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n,t){var s,o,a,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.setSubmitting,e.prev=1,o=n.permissions.filter((function(e){return e.permissions})).map((function(e){return{module_id:e.id,allowed_actions:e.permissions}})),e.next=5,F.Z.patch("".concat(R.t6,"api/roles&permissions"),{role_id:r.role_id,module_permissions:o});case 5:if(!(a=e.sent).data.success){e.next=13;break}return!0,e.next=10,ie(true);case 10:E().fire({icon:"success",title:"Success",text:"Permissions updated successfully",showConfirmButton:!0}),e.next=15;break;case 13:throw E().fire({icon:"error",title:"Error",text:a.data.message||"Failed to save permissions",showConfirmButton:!0}),new Error(a.data.message||"Failed to save permissions");case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),console.error("Error saving permissions:",e.t0),E().fire({icon:"error",title:"Error",text:(null===(l=e.t0.response)||void 0===l||null===(c=l.data)||void 0===c?void 0:c.message)||"Failed to save permissions",showConfirmButton:!0});case 21:return e.prev=21,s(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[1,17,21,24]])})));return function(n,r){return e.apply(this,arguments)}}(),oe=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n,r){var t,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.setSubmitting,s=r.resetForm,e.prev=1,!J){e.next=9;break}return e.next=5,F.Z.patch("".concat(R.t6,"api/modules&permissions/").concat(J.module_id),{module:n.moduleName.trim(),actions:[].concat(q)});case 5:e.sent.data.success&&E().fire({icon:"success",title:"Module Updated",text:"The module has been updated successfully.",showConfirmButton:!0}),e.next=13;break;case 9:return e.next=11,F.Z.post("".concat(R.t6,"api/modules&permissions"),{module:n.moduleName.trim(),actions:[].concat(q)});case 11:e.sent.data.success&&E().fire({icon:"success",title:"Module Added",text:"The new module has been added successfully.",showConfirmButton:!0});case 13:return e.next=15,ie();case 15:te(),s(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.error("Failed to save module:",e.t0),E().fire({icon:"error",title:"Error",text:"Failed to save module. Please try again.",showConfirmButton:!0});case 23:return e.prev=23,t(!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,19,23,26]])})));return function(n,r){return e.apply(this,arguments)}}(),ae=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E().fire({title:"Are you sure?",text:'Do you want to delete the module "'.concat(n.module,'"?'),icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"});case 2:if(!e.sent.isConfirmed){e.next=18;break}return e.prev=4,e.next=7,F.Z.patch("".concat(R.t6,"api/modules&permissions/").concat(n.id,"/archive"));case 7:if(!e.sent.data.success){e.next=12;break}return E().fire({icon:"success",title:"Deleted!",text:"The module has been deleted.",showConfirmButton:!0}),e.next=12,ie();case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(4),console.error("Failed to delete module:",e.t0),E().fire({icon:"error",title:"Error",text:"Failed to delete module. Please try again.",showConfirmButton:!0});case 18:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(n){return e.apply(this,arguments)}}();return Q?(0,T.jsx)(c.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,T.jsx)(d.Z,{})}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{mb:3},children:[(0,T.jsxs)(m.Z,{variant:"h5",fontWeight:700,gutterBottom:!0,children:["Set Permissions for ",null===r||void 0===r?void 0:r.name]}),(0,T.jsx)(p.Z,{variant:"contained",onClick:function(){U(null),z(!0)},disabled:!0,className:"hidden",children:"Add New Module"})]}),(0,T.jsx)(f.Z,{sx:{mb:3}}),(0,T.jsx)(u.Z,{direction:"row",spacing:2,sx:{mb:3},children:(0,T.jsx)(p.Z,{onClick:n,variant:"outlined",color:"secondary",startIcon:(0,T.jsx)(B.Z,{}),children:"Back"})}),(0,T.jsx)(N.J9,{initialValues:ne,onSubmit:se,enableReinitialize:!0,children:function(e){var r=e.values,i=e.setFieldValue,s=e.isSubmitting,o=e.handleSubmit;return(0,T.jsxs)(N.l0,{onSubmit:o,children:[(0,T.jsx)(h.ZP,{container:!0,spacing:2,children:O.map((function(e){var n=r.permissions.find((function(n){return n.id===e.id})),s=n?n.permissions:[];return(0,T.jsx)(h.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,T.jsxs)(x.Z,{sx:{mb:3,boxShadow:2,height:"100%"},children:[(0,T.jsx)(Z.Z,{title:e.module,action:(0,T.jsxs)(u.Z,{direction:"row",gap:1,children:[(0,T.jsx)(p.Z,{size:"small",onClick:function(){return function(e,n,r){var i=(0,t.Z)(r.permissions),s=i.findIndex((function(n){return n.id===e.id}));-1===s?i.push({id:e.id,module_id:e.module_id,module:e.module,permissions:[].concat(q)}):i[s].permissions=[].concat(q),n("permissions",i)}(e,i,r)},children:"Select All"}),(0,T.jsx)(p.Z,{size:"small",color:"error",onClick:function(){return function(e,n,r){var i=(0,t.Z)(r.permissions),s=i.findIndex((function(n){return n.id===e.id}));-1!==s&&(i[s].permissions=[],n("permissions",i))}(e,i,r)},children:"Clear All"})]})}),(0,T.jsx)(f.Z,{}),(0,T.jsx)(b.Z,{children:(0,T.jsx)(h.ZP,{container:!0,spacing:2,children:q.map((function(n){var o=s.includes(n);return(0,T.jsx)(h.ZP,{item:!0,xs:6,children:(0,T.jsx)(v.Z,{control:(0,T.jsx)(g.Z,{checked:o,onChange:function(s){return function(e,n,r,i,s){var o=(0,t.Z)(s.permissions),a=o.findIndex((function(n){return n.id===e.id}));-1===a?o.push({id:e.id,module_id:e.module_id,module:e.module,permissions:r?[n]:[]}):r?o[a].permissions.includes(n)||o[a].permissions.push(n):o[a].permissions=o[a].permissions.filter((function(e){return e!==n})),i("permissions",o)}(e,n,s.target.checked,i,r)},color:"primary"}),label:n.charAt(0).toUpperCase()+n.slice(1)})},n)}))})}),(0,T.jsx)(j.Z,{className:"hidden",children:(0,T.jsxs)(c.Z,{sx:{flex:1,display:"flex",justifyContent:"space-between"},children:[(0,T.jsx)(p.Z,{size:"small",color:"primary",onClick:function(){return function(e){U(e),z(!0)}(e)},disabled:!0,children:"Edit"}),(0,T.jsx)(p.Z,{size:"small",color:"error",onClick:function(){return ae(e)},disabled:!0,children:"Delete"})]})})]})},e.id)}))}),(0,T.jsx)(f.Z,{sx:{my:3}}),(0,T.jsxs)(u.Z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,T.jsx)(p.Z,{variant:"outlined",onClick:n,children:"Cancel"}),(0,T.jsx)(p.Z,{type:"submit",variant:"contained",color:"primary",disabled:s,children:s?"Saving...":"Save Permissions"})]})]})}}),(0,T.jsxs)(C.Z,{open:L,onClose:te,maxWidth:"xs",fullWidth:!0,children:[(0,T.jsxs)(k.Z,{className:"dialogTitle",children:[J?"Edit Module":"Add Module",(0,T.jsx)(w.Z,{color:"dark",onClick:te,edge:"end",size:"big","aria-label":"close",title:"close",children:(0,T.jsx)(A.Z,{height:30})})]}),(0,T.jsx)(f.Z,{}),(0,T.jsx)(N.J9,{initialValues:J?{moduleName:J.module,permissions:J.permissions||[]}:{moduleName:"",permissions:[]},validate:function(e){var n={};return e.moduleName||(n.moduleName="Module name is required"),n},onSubmit:oe,enableReinitialize:!0,children:function(e){var n=e.errors,r=e.touched,t=e.handleChange,i=e.handleBlur,s=e.values,o=e.isSubmitting,a=e.handleSubmit;return(0,T.jsxs)(N.l0,{onSubmit:a,children:[(0,T.jsx)(y.Z,{children:(0,T.jsx)(c.Z,{children:(0,T.jsxs)(u.Z,{spacing:2,children:[(0,T.jsx)(S.Z,{children:"Module Name*"}),(0,T.jsx)(P.Z,{fullWidth:!0,id:"moduleName",name:"moduleName",placeholder:"Module Name",value:s.moduleName,onChange:t,onBlur:i,error:r.moduleName&&Boolean(n.moduleName),helperText:r.moduleName&&n.moduleName,disabled:o})]})})}),(0,T.jsxs)(_.Z,{sx:{p:3,pt:0},children:[(0,T.jsx)(p.Z,{onClick:te,disabled:o,children:"Cancel"}),(0,T.jsx)(p.Z,{type:"submit",variant:"contained",disabled:o||!s.moduleName.trim(),children:o?"Saving...":J?"Update":"Add Module"})]})]})}})]})]})}},85523:function(e,n,r){r.d(n,{Z:function(){return w}});var t=r(4942),i=r(63366),s=r(87462),o=r(72791),a=r(59278),l=r(94419),c=r(52930),d=r(36314),u=r(20890),m=r(14036),p=r(66934),f=r(31402),h=r(75878),x=r(21217);function Z(e){return(0,x.ZP)("MuiFormControlLabel",e)}var b=(0,h.Z)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),v=r(76147),g=r(80184),j=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],C=(0,p.ZP)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:function(e,n){var r=e.ownerState;return[(0,t.Z)({},"& .".concat(b.label),n.label),n.root,n["labelPlacement".concat((0,m.Z)(r.labelPlacement))]]}})((function(e){var n=e.theme,r=e.ownerState;return(0,s.Z)((0,t.Z)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16},"&.".concat(b.disabled),{cursor:"default"}),"start"===r.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===r.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===r.labelPlacement&&{flexDirection:"column",marginLeft:16},(0,t.Z)({},"& .".concat(b.label),(0,t.Z)({},"&.".concat(b.disabled),{color:(n.vars||n).palette.text.disabled})))})),k=(0,p.ZP)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:function(e,n){return n.asterisk}})((function(e){var n=e.theme;return(0,t.Z)({},"&.".concat(b.error),{color:(n.vars||n).palette.error.main})})),w=o.forwardRef((function(e,n){var r,t,p=(0,f.Z)({props:e,name:"MuiFormControlLabel"}),h=p.className,x=p.componentsProps,b=void 0===x?{}:x,w=p.control,y=p.disabled,S=p.disableTypography,P=p.label,_=p.labelPlacement,N=void 0===_?"end":_,B=p.required,F=p.slotProps,M=void 0===F?{}:F,E=(0,i.Z)(p,j),R=(0,c.Z)(),A=null!=(r=null!=y?y:w.props.disabled)?r:null==R?void 0:R.disabled,T=null!=B?B:w.props.required,q={disabled:A,required:T};["checked","name","onChange","value","inputRef"].forEach((function(e){"undefined"===typeof w.props[e]&&"undefined"!==typeof p[e]&&(q[e]=p[e])}));var I=(0,v.Z)({props:p,muiFormControl:R,states:["error"]}),L=(0,s.Z)({},p,{disabled:A,labelPlacement:N,required:T,error:I.error}),z=function(e){var n=e.classes,r=e.disabled,t=e.labelPlacement,i=e.error,s=e.required,o={root:["root",r&&"disabled","labelPlacement".concat((0,m.Z)(t)),i&&"error",s&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",i&&"error"]};return(0,l.Z)(o,Z,n)}(L),D=null!=(t=M.typography)?t:b.typography,W=P;return null==W||W.type===u.Z||S||(W=(0,g.jsx)(u.Z,(0,s.Z)({component:"span"},D,{className:(0,a.Z)(z.label,null==D?void 0:D.className),children:W}))),(0,g.jsxs)(C,(0,s.Z)({className:(0,a.Z)(z.root,h),ownerState:L,ref:n},E,{children:[o.cloneElement(w,q),T?(0,g.jsxs)(d.Z,{display:"block",children:[W,(0,g.jsxs)(k,{ownerState:L,"aria-hidden":!0,className:z.asterisk,children:["\u2009","*"]})]}):W]}))}))}}]);
//# sourceMappingURL=9997.15cc442e.chunk.js.map